<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <button class="buttonToolNav" onclick="switchCards()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="color: inherit;">
                <path style="color: inherit;" fill="currentColor" d="M105.1 202.6c7.7-21.8 20.2-42.3 37.8-59.8c62.5-62.5 163.8-62.5 226.3 0L386.3 160H352c-17.7 0-32 14.3-32 32s14.3 32 32 32H463.5c0 0 0 0 0 0h.4c17.7 0 32-14.3 32-32V80c0-17.7-14.3-32-32-32s-32 14.3-32 32v35.2L414.4 97.6c-87.5-87.5-229.3-87.5-316.8 0C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5zM39 289.3c-5 1.5-9.8 4.2-13.7 8.2c-4 4-6.7 8.8-8.1 14c-.3 1.2-.6 2.5-.8 3.8c-.3 1.7-.4 3.4-.4 5.1V432c0 17.7 14.3 32 32 32s32-14.3 32-32V396.9l17.6 17.5 0 0c87.5 87.4 229.3 87.4 316.7 0c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.5 62.5-163.8 62.5-226.3 0l-.1-.1L125.6 352H160c17.7 0 32-14.3 32-32s-14.3-32-32-32H48.4c-1.6 0-3.2 .1-4.8 .3s-3.1 .5-4.6 1z"/>
            </svg>
        </button>
        <button class="buttonToolNav" onclick="newHero()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="color: inherit;">
                <path style="color: inherit;" fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"/>
            </svg>
        </button>
        <img id="logoDC" src="imgs/DC_Comics_logo.png" alt="" width="100px" check>
        <img id="logoMarvel" src="imgs/Marvel2.png" alt="" width="140px" check>
    </nav>
    <div class="containerSearch">
        <input class="search" type="text" name="" id="searchInput">
    </div>
    <main id="containerCards">
        <div class="ContCard" id="cardBatMan">
            <section class="card DC" id="CDC1">
                <button class="deleteCard" onclick="showAlert('CDC1')">X</button>
                <p class="titleCard">BatMan</p>
                <article class="imgContainer">
                    <div class="switchImages" id="switchImg1" style="transform: translateY(0%);">
                        <img src="imgs/DC/Batman.png" width="100%">
                        <img src="imgs/DC/Batman.png" width="100%">
                    </div>
                </article>
                <div class="namePJ">nombrePJ</div>
                <article class="infoContainer">
                    <p>Nacido en el planeta Krypton como Kal-El, fue enviado a la Tierra antes de la destrucción de su planeta. Criado por una familia de granjeros en Kansas, Clark Kent desarrolló habilidades sobrehumanas y decidió usar sus poderes para proteger a la humanidad como Superman.</p>
                </article>
                <div class="containerShowInfo">
                    <button class="showInfo" onclick="showDialogInfo('BatMan')">Ver</button>
                </div>
            </section>
        </div>
        <div class="ContCard" id="cardThor">
            <section class="card Marvel" id="CMarvel1">
                <button class="deleteCard" onclick="deleteCard('CMarvel1')">X</button>
                <p class="titleCard">Thor</p>
                <article class="imgContainer">
                    
                </article>
                <div class="namePJ">nombrePJ</div>
                <article class="infoContainer">
                    
                </article>
                <div class="containerShowInfo">
                    <button class="showInfo">Ver</button>
                </div>
            </section>
        </div>
        <div class="ContCard" id="cardHulk">
            <section class="card Marvel" id="CMarvel2">
                <button class="deleteCard" onclick="deleteCard('CMarvel2')">X</button>
                <p class="titleCard">Hulk</p>
                <article>
                    
                </article>
                <div class="containerShowInfo">
                    <button class="showInfo">Ver</button>
                </div>
            </section>
        </div>
        <div class="ContCard" id="cardIronMan">
            <section class="card Marvel" id="CMarvel2">
                <button class="deleteCard" onclick="deleteCard('CDC2')">X</button>
                <p class="titleCard">IronMan</p>
                <article>
                    
                </article>
                <div class="containerShowInfo">
                    <button class="showInfo">Ver</button>
                </div>
            </section>
        </div>
    </main>
    <dialog class="dialogInfo" id="dialogInfo">
        <button class="buttonDelete DC" id="buttonCloseInfo" onclick="closeDialogInfo()">X</button>
        <button class="buttonDelete DC" id="buttonEditInfo" onclick="editHero('CDC1')">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path style="color: inherit;" fill="currentColor" d="M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z"/>
            </svg>
        </button>
        <button class="buttonDelete DC Del" id="buttonDeleteInfoDialog" onclick="showAlert('CDC1')">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                <path style="color: inherit;" fill="currentColor" d="M170.5 51.6L151.5 80h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6H177.1c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6L354.2 80H368h48 8c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8V432c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128H24c-13.3 0-24-10.7-24-24S10.7 80 24 80h8H80 93.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128V432c0 17.7 14.3 32 32 32H336c17.7 0 32-14.3 32-32V128H80zm80 64V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16z"/>
            </svg>
        </button>
        <section class="dialogCard DC" id="dialogCard">
            <img class="logoMarvelDialog" id="logoDialog" src="imgs/Marvel2.png" alt="" >
            <p class="titleCard" id="infoNombre">Nombre</p>
            <div class="imgContainer" id="imgContainer">
                
            </div>
            <article>
                <div class="simpleData">
                    <div><span>nombrePJ: </span><span class="data" id="infoNombrePJ"></span></div>
                    <div><span>año de aparición: </span><span class="data" id="infoAño"></span></div>
                    <div><span>casa: </span><span class="data" id="infoCasa"></span></div>
                </div>
                <p>equipamiento:</p><div class="data" id="infoEquipment"></div>
                <p>biografía:</p>
                <div class="bioContainer" id="infoBio"></div>
            </article>
        </section>
    </dialog>

    <dialog class="dialogAlert" id="dialogAlert">
       <section class="DC">
            <h1>Eliminación</h1>
            <article>
                <p>¿Está seguro que desea eliminar este personaje?</p>
                <p>Si lo hace, no podrá recuperar la información y deberá volver a crearlo si desea recuperarlo.</p>
                <div>
                    <button onclick="deleteCard('CDC1')">SI</button>
                    <button onclick="closeDialogAlert()">NO</button>
                </div>

            </article>
       </section>
    </dialog>
    <div class="conteinerMainNewCard " id="conteinerNewCard">
        <main class="mainNewCard" id="mainCard">
            <button class="closeMainNewCard" onclick="closeNewHero()">X</button>
            <div class="imgContainer">
                <div class="image" id="imagePreView">
                </div>
                <button id="newImage" onclick="addIMG()">cargar</button>
                <div class="imgsSelected" id="imgsSelected">
                </div>
            </div>
            <div class="data1">
                <div class="nameContainer">
                    <label for="nombre">nombre:</label> 
                    <input id="nombre" type="text">
                </div>
                <div class="namePJContainer">
                    <label for="nombrePJ">nombrePJ: </label>
                    <input id="nombrePJ" type="text">
                </div>
                <div class="yearContainer">
                    <label for="año">año de aparición: </label>
                    <input id="año" type="text">
                </div>
                <div class="homeContainer">
                    <label for="casa">casa</label>
                    <select for="casa" name="casa" id="homeSelector" onchange="emptyImgSelector()">
                        <option value="Ninguno" selected>Ninguno</option>
                        <option value="Marvel">Marvel</option>
                        <option value="DC">DC</option>
                    </select>
                    <div id="logoContainer" style="height: 100px;"></div>
                </div>
            </div>
            <div class="equipmentContainer"><p>equipamiento</p><textarea name="" id="equipamiento" rows="10" cols="40" style="resize: none"></textarea></div>
            <div class="bioContainer"><p>biografía</p><textarea name="" id="bio" rows="10" cols="40" style="resize: none"></textarea></div>
            <button id="saveHero" onclick="saveHero()">Guardar Heroe</button>
        </main>
    </div>
    <div class='containerAddImage hide' id="containerAddImage">
        <main class='mainAddImage' id='mainAddImage'>
            <button class='closeMainNewCard' onclick='closeAddImage()'>X</button>
            <div class='imgsContainer' id="imgsContainer">

            </div>
        </main>
    </div>
    <div class="notificationMessage DC hide none" id="notificationCard">
        Se ha eliminado correctamente este heroe y muchas otras cosas más
    </div>
</body>
</html>

<script>
    function loadAllHeros(){
        switchImgActive = false;
        fetch(`http://localhost:5000/allHeroes`)
        .then(response => response.text())
        .then(htmlCards => {
            //console.log(htmlCards);
            document.getElementById("containerCards").innerHTML = htmlCards
        }).then(data => {
            searchHero();
            generateSwitcherImages();
        })
    }

    function loadHerosMarvel(){
        switchImgActive = false;
        fetch(`http://localhost:5000/allHeroes/Marvel`)
        .then(response => response.text())
        .then(htmlCards => {
            //console.log(htmlCards);
            document.getElementById("containerCards").innerHTML = htmlCards
        }).then(data => {
            searchHero();
            generateSwitcherImages();
        })
    }
    function loadHerosDC(){
        switchImgActive = false;
        fetch(`http://localhost:5000/allHeroes/DC`)
        .then(response => response.text())
        .then(htmlCards => {
            //console.log(htmlCards);
            document.getElementById("containerCards").innerHTML = htmlCards
        }).then(data => {
            searchHero();
            generateSwitcherImages();
        })
    }
    let intervalId = null;
    let switchImgActive = false;
    let switchImgsData = []
    function generateSwitcherImages(){
        switchImgsData = [];
        let switchesImg = document.querySelectorAll(".switchImages");
        switchesImg.forEach(switcher =>{
            let newSwitcher = switcher.cloneNode(true);
            switcher.parentNode.replaceChild(newSwitcher, switcher);
            let cantImg = newSwitcher.querySelectorAll("img").length;
            console.log(cantImg);
            if(cantImg > 1){
                console.log("createEventSwitch")
                switchImgsData.push({switch: newSwitcher, cantImg: cantImg});
            }
        })
        switchImgActive = true;
        
        if (intervalId !== null) {
            clearInterval(intervalId);
        }
        intervalId = null;
        switchImages();
    }
    function switchImages(){
        intervalId = setInterval(function() {
            console.log("switche active")
            switchImgsData.forEach(switchData => {
                let cantMove = 100/switchData.cantImg;
                //console.log(switchData.switch);
                let style = window.getComputedStyle(switchData.switch);
                //console.log("switch style: "+style);
                let transform = style.transform;
                //console.log("switch transform: "+transform);
                let match = transform.match(/matrix\(([-\d., ]+)\)/);
                if(match){
                    let translateY = match[1].split(', ');
                    let value = parseFloat(translateY[5]);
                    //console.log("switch value: "+value);
                    if(value-cantMove > -100){
                        switchData.switch.style.transform = `translateY(${value-cantMove}%)`
                    }else{
                        switchData.switch.style.transform = `translateY(${0}%)`
                    }
                }
            })
        }, 3000);
    }


    document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("searchInput").addEventListener("keyup", function(){
            searchHero();
        })
        switchCards();
    })
   
    document.getElementById("logoMarvel").addEventListener("click", function(){
        let logo = document.getElementById("logoMarvel")
        if(logo.hasAttribute("check")){
            document.getElementById("logoMarvel").removeAttribute("check");
            // ocultar las targetas de Marvel desde front
            // document.getElementById("containerCards").querySelectorAll(":scope > div").forEach((card) => {
            //     console.log(card)
            //     let viewCard = card.querySelector("section");
            //     if(viewCard.classList.contains("Marvel")){
            //         card.classList.add("hiden");
            //     }
            // })
        }
        else {
            document.getElementById("logoMarvel").setAttribute("check","");
            //mostrar las targetas de Marvel desde front
            // document.getElementById("containerCards").querySelectorAll(":scope > div").forEach((card) => {
            //     console.log(card)
            //     let viewCard = card.querySelector("section");
            //     if(viewCard.classList.contains("Marvel")){
            //         card.classList.remove("hiden");
            //     }
            // })
        }
        switchCards();
        searchHero();
    })
    document.getElementById("logoDC").addEventListener("click", function(){
        let logo = document.getElementById("logoDC");
        if(logo.hasAttribute("check"))
        {
            document.getElementById("logoDC").removeAttribute("check");
            //esconder las targetas de Marvel desde front
            // document.getElementById("containerCards").querySelectorAll(":scope > div").forEach((card) => {
            //     console.log(card)
            //     let viewCard = card.querySelector("section");
            //     if(viewCard.classList.contains("DC")){
            //         card.classList.add("hiden");
            //     }
            // })
        }
        else {
            document.getElementById("logoDC").setAttribute("check","");
            //mostrar las targetas de Marvel desde front
            // document.getElementById("containerCards").querySelectorAll(":scope > div").forEach((card) => {
            //     console.log(card)
            //     let viewCard = card.querySelector("section");
            //     if(viewCard.classList.contains("DC")){
            //         card.classList.remove("hiden");
            //     }
            // })
        }
        switchCards();
        
    })

    function switchCards(){
        let logoMarvel = document.getElementById("logoMarvel").hasAttribute("check");
        let logoDC = document.getElementById("logoDC").hasAttribute("check");
        switch (`${logoMarvel}-${logoDC}`) {
        case 'true-true':
            loadAllHeros();
            break;
        case 'true-false':
            loadHerosMarvel();
            break;
        case 'false-true':
            loadHerosDC();
            break;
        case 'false-false':
            document.getElementById("containerCards").innerHTML = "Sin casa seleccionada"
            break;
        default:
            loadAllHeros();
        }
        console.log("switchCards activated")
    }
    
    function searchHero(){
        let name = document.getElementById("searchInput").value.toLowerCase();
        //console.log(name)
        let mainCards = document.getElementById("containerCards");
        if(name != null && name != ""){
            mainCards.querySelectorAll(":scope > div").forEach((cardContainer) =>{
                if(cardContainer.id.toLowerCase().includes("card")){
                    if(cardContainer.id.toLowerCase().replace("card","").includes(name)){
                        //console.log(cardContainer.id.toLowerCase(), "block")                            if(!cardContainer.classList.contains("hiden"))
                        cardContainer.style.display = "";    
                    }else{
                        //console.log(cardContainer.id.toLowerCase(), "none")
                        cardContainer.style.display = "none";
                    }
                }
            })
        }else{
            //console.log("borra")
            mainCards.querySelectorAll("div").forEach((cardContainer) =>{
                if(!cardContainer.classList.contains("hiden"))
                    cardContainer.style.display = "";
            })
        }
    }

    function showAlert(id){
        let dialogAlert;
        if(id.includes("Marvel")){
            dialogAlert = "<section class='Marvel'>"
        }else if(id.includes("DC")){
            dialogAlert = "<section class='DC'>"
        }
        dialogAlert = dialogAlert 
        +    "<h1>Eliminación</h1>"
        +    "<article>"
        +        "<p>¿Está seguro que desea eliminar este personaje?</p>"
        +        "<p>Si lo hace, no podrá recuperar la información y deberá volver a crearlo si desea recuperarlo.</p>"
        +        "<div>"
        +            `<button onclick='deleteCard("${id}")'>SI</button>`
        +            "<button onclick='closeDialogAlert()'>NO</button>"
        +        "</div>"
        +    "</article>"
        +"</section>";
        document.getElementById("dialogAlert").innerHTML=dialogAlert;
        document.getElementById("dialogAlert").showModal();
    }
    
    function closeDialogAlert(){
        document.getElementById("dialogAlert").close();
    }

    function showDialogInfo(nameHero, idCard){

        fetch(`http://localhost:5000/heroData/${nameHero}`)
        .then(response => response.json())
        .then(data => {
            console.log(data);
            
            if(data.casa=="Marvel"){
                document.getElementById("buttonCloseInfo").classList.replace("DC", "Marvel");
                document.getElementById("buttonEditInfo").classList.replace("DC", "Marvel");
                document.getElementById("buttonDeleteInfoDialog").classList.replace("DC", "Marvel");
                document.getElementById("dialogCard").classList.replace("DC", "Marvel");
            }else{
                document.getElementById("buttonCloseInfo").classList.replace("Marvel", "DC");
                document.getElementById("buttonEditInfo").classList.replace("Marvel", "DC");
                document.getElementById("buttonDeleteInfoDialog").classList.replace("Marvel", "DC");
                document.getElementById("dialogCard").classList.replace("Marvel", "DC");
            }

            let buttonRemove = document.getElementById("buttonDeleteInfoDialog");
            let buttonEditInfo = document.getElementById("buttonEditInfo");
            
            buttonRemove.removeEventListener('click', buttonRemove.onclick);
            buttonRemove.addEventListener('click', () => showAlert(idCard));

            buttonEditInfo.removeEventListener('click', buttonEditInfo.onclick);
            buttonEditInfo.addEventListener('click', () => editHero(data));

            document.getElementById("infoNombre").innerHTML=data.nombre;

            if(data.imgs.length > 0)
                document.getElementById("imgContainer").innerHTML = `<img src="imgs/${data.casa}/${data.imgs[0]}" width="100%">`
            else document.getElementById("imgContainer").innerHTML = `<div>¿?</div>`

            document.getElementById("infoNombrePJ").innerHTML=data.nombrePJ;
            document.getElementById("infoAño").innerHTML=data.añoAparición;
            document.getElementById("infoCasa").innerHTML=data.casa;
            document.getElementById("infoEquipment").innerHTML=data.equipamiento;
            document.getElementById("infoBio").innerHTML=data.biografía;

            let img = document.getElementById("logoDialog");
            console.log(document.getElementById("logoDialog").src.includes("DC"));
            let srcImg = img.src;
            console.log(srcImg + " == "+ data.casa);
            if(img.src.includes("Marvel") && data.casa=="DC"){
                img.src = "imgs/DC_Comics_logo.png";
                img.classList.replace("logoMarvelDialog","logoDCDialog")
            }else if(img.src.includes("DC") && data.casa=="Marvel"){
                img.src = "imgs/Marvel2.png";
                img.classList.replace("logoDCDialog","logoMarvelDialog")
            }
        }).then(data => {
            document.getElementById("dialogInfo").showModal();
        })  
    }

    function closeDialogInfo(){
        document.getElementById("infoNombre").innerHTML="";
        document.getElementById("imgContainer").innerHTML ="";
        document.getElementById("infoNombrePJ").innerHTML="";
        document.getElementById("infoAño").innerHTML="";
        document.getElementById("infoCasa").innerHTML="";
        document.getElementById("infoEquipment").innerHTML="";
        document.getElementById("infoBio").innerHTML="";

        document.getElementById("dialogInfo").close();
    }

    function deleteCard(id){
        console.log("elimina " + id);
        let card = document.getElementById(id);
        let name = card.querySelector(".titleCard").textContent;
        let casa;
        if(card.classList.contains("Marvel")){
            casa = "Marvel";
        }else if(card.classList.contains("DC")){
            casa = "DC";
        }
        document.getElementById(id).parentElement.remove();
        document.getElementById("dialogAlert").close();
        console.log(name);
        fetch(`http://localhost:5000/deleteHero/${name}`, {
            method: 'DELETE',
            mode: 'cors',
        })
        closeDialogInfo();
        showNotification("delete",casa);
    }

    let listNotification = [[]]
    async function showNotification(status, casa){
        let notificationCard = document.getElementById("notificationCard");
        listNotification.push({ status, casa });

        while (listNotification.length > 0 && notificationCard.classList.contains("hide")) {
            let notification = listNotification.shift();

            switch (notification.status) {
                case "delete":
                    notificationCard.classList.remove("none");
                    notificationCard.classList.remove("DC", "Marvel");
                    notificationCard.classList.add(notification.casa);
                    notificationCard.innerHTML = "Se ha eliminado correctamente este heroe."
                    notificationCard.classList.remove("hide");
                    await sleep(3000);
                    notificationCard.classList.add("hide");
                    await sleep(2000);
                break;
                case "creado":
                    notificationCard.classList.remove("none");
                    notificationCard.classList.remove("DC", "Marvel");
                    notificationCard.classList.add(notification.casa);
                    notificationCard.innerHTML = "Se ha creado correctamente este nuevo heroe."
                    notificationCard.classList.remove("hide");
                    await sleep(3000);
                    notificationCard.classList.add("hide");
                    await sleep(2000);
                break;
                case "error":
                    notificationCard.classList.remove("none");
                    notificationCard.classList.remove("DC", "Marvel");
                    notificationCard.classList.add(notification.casa);
                    notificationCard.innerHTML = "No se ha podido crear o modificar el heroe. Los problemas pueden ser: <br> - Heroe repetido <br> - No seleccionó una casa"
                    notificationCard.classList.remove("hide");
                    await sleep(3000);
                    notificationCard.classList.add("hide");
                    await sleep(2000);
                break;
                case "editado":
                    notificationCard.classList.remove("none");
                    notificationCard.classList.remove("DC", "Marvel");
                    notificationCard.classList.add(notification.casa);
                    notificationCard.innerHTML = "se he editado correctamente el heroe."
                    notificationCard.classList.remove("hide");
                    await sleep(3000);
                    notificationCard.classList.add("hide");
                    await sleep(2000);
                break;
            }
        }
        if(listNotification.length <= 0)
            notificationCard.classList.add("none");
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }


    //nuevo heroe
    function newHero(){
        document.getElementById("conteinerNewCard").classList.remove("hide");
        typeSave = "save";
    }
    function closeNewHero(){
        document.getElementById("conteinerNewCard").classList.add("hide");
        document.getElementById("nombre").value = "";
        document.getElementById("nombrePJ").value = "";
        document.getElementById("año").value = "";
        document.getElementById("homeSelector").value = 1;
        document.getElementById("equipamiento").value = "";
        document.getElementById("bio").value = "";
        document.getElementById("logoContainer").innerHTML = ' ';
        document.getElementById("mainCard").classList.remove("DC", "Marvel");
        emptyImgSelector();
    }

    document.getElementById("homeSelector").addEventListener("change", function(){
        document.getElementById("mainCard").classList.remove("DC", "Marvel");
        let casa = document.getElementById("homeSelector").value
        if(casa != "Ninguno"){
            document.getElementById("mainCard").classList.add(casa);
            switch (casa) {
            case "Marvel":
                document.getElementById("logoContainer").innerHTML = '<img src="imgs/Marvel2.png" alt="" width="120px">'
                break;
            case "DC":
                document.getElementById("logoContainer").innerHTML = '<img src="imgs/DC_Comics_logo.png" alt="" width="80px">'
                break;
            default:
                document.getElementById("logoContainer").innerHTML = ' '
                break;
            }
        }else document.getElementById("logoContainer").innerHTML = ' ';
    })
    
    let typeSave = "save"
    let nameToEdit = ""
    function saveHero(){
        let name = document.getElementById("nombre").value
        let namePJ = document.getElementById("nombrePJ").value
        let year = document.getElementById("año").value
        let home = document.getElementById("homeSelector").value
        let equipment = document.getElementById("equipamiento").value
        let bio = document.getElementById("bio").value
        
        let spansImgsSelector = document.getElementById("imgsSelected").querySelectorAll("span");
        let namesImgs = [];

        spansImgsSelector.forEach(span =>{
            namesImgs.push(span.id.replace("img_","")+".png");
        })

        if(home != "Ninguno" && home != null && home != ""
        && name != null && name != ""){
            let obj = {
                "nombre": name,
                "nombrePJ": namePJ,
                "añoAparición": year,
                "casa": home,
                "biografía":bio,
                "equipamiento":equipment,
                "NumImages":namesImgs.length,
                "imgs":namesImgs
            }
            if(typeSave == "save"){
                console.log("saveHero");
                fetch(`http://localhost:5000/newHero`, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(obj)
                })
                .then(response => {
                    if(response.status >= 200 && response.status < 300){
                        console.log("OK");
                        closeNewHero();
                        showNotification("creado", home);
                        switchCards();
                    }
                    if(response.status >= 400){
                        console.error("ERROR");
                        showNotification("error", home);
                    }
                })
            }else if(typeSave == "edit"){
                console.log("updateHero");
                let obj = {
                    "editarHeroe":nameToEdit,
                    "nombre": name,
                    "nombrePJ": namePJ,
                    "añoAparición": year,
                    "casa": home,
                    "biografía":bio,
                    "equipamiento":equipment,
                    "NumImages":namesImgs.length,
                    "imgs":namesImgs
                }
                fetch(`http://localhost:5000/updateHero`, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(obj)
                })
                .then(response => {
                    if(response.status >= 200 && response.status < 300){
                        console.log("OK");
                        closeNewHero();
                        showNotification("editado", home);
                        switchCards();
                    }
                    if(response.status >= 400){
                        console.error("ERROR");
                        showNotification("error", home);
                    }
                    closeNewHero();
                })
            }
        }else{
            showNotification("error", home);
        }
        
    }

    function editHero(dataHero){
        closeDialogInfo();
        document.getElementById("nombre").value = dataHero.nombre;
        document.getElementById("nombrePJ").value = dataHero.nombrePJ;
        document.getElementById("año").value = dataHero.añoAparición;
        document.getElementById("homeSelector").value = dataHero.casa;
        document.getElementById("equipamiento").value = dataHero.equipamiento;
        document.getElementById("bio").value = dataHero.biografía;
        let htmlToAdd = "";
        dataHero.imgs.forEach(imgName =>{
             htmlToAdd = htmlToAdd + `<span id="img_${imgName.split('.')[0]}" onmouseover="showImg('${imgName}')" onmouseleave="notShowImg()"><button onclick="removeImg('${imgName.split('.')[0]}')">X</button>${imgName.split('.')[0]}</span>`
        })
        document.getElementById("imgsSelected").innerHTML = htmlToAdd;
        switch (dataHero.casa) {
            case "DC":
                document.getElementById("logoContainer").innerHTML = '<img src="imgs/DC_Comics_logo.png" alt="" width="80px">'
                break;
            case "Marvel":
                document.getElementById("logoContainer").innerHTML = '<img src="imgs/Marvel2.png" alt="" width="120px">'
                break;
            default:
                break;
        }
        document.getElementById("mainCard").classList.add(dataHero.casa);
        document.getElementById("conteinerNewCard").classList.remove("hide");
        nameToEdit = dataHero.nombre;
        typeSave = "edit";
    }

    function addIMG(){
        console.log("entra al ADDIMG")
        let home = document.getElementById("homeSelector").value;
        fetch(`http://localhost:5000/allImages/${home}`)
        .then(response => response.text())
        .then( textArray => {
            let imgsNames = JSON.parse(textArray);
            let containerImgs = document.getElementById("imgsContainer");
            let htmlToInsert = ""
            imgsNames.forEach(name => {
                htmlToInsert = htmlToInsert + `<button class="butSelectImg" onclick="selectImgToAdd('${name}')"><img src="imgs/${home}/${name}" width="200px" height="200px"></button>` 
            });
            console.log(containerImgs);
            containerImgs.innerHTML = htmlToInsert;
        }).then(data => {
            document.getElementById("mainAddImage").classList.add(home)
            document.getElementById("containerAddImage").classList.remove("hide");
        })
    }

    function closeAddImage(){
        let home = document.getElementById("homeSelector").value;
        document.getElementById("mainAddImage").classList.remove(home)
        document.getElementById("containerAddImage").classList.add("hide");
    }
    
    function selectImgToAdd(name){
        let contImgsSelected = document.getElementById("imgsSelected");
        let nameClean = name.split('.')[0]
        let htmlToAdd = `<button onclick="removeImg('${nameClean}')">X</button>${nameClean}`;
        let spanElement = document.createElement('span');
        spanElement.id = `img_${nameClean}`
        spanElement.onmouseover = function(){
            showImg(`${name}`);
        };
        spanElement.onmouseleave = function (){
            notShowImg()
        };
        spanElement.innerHTML = htmlToAdd;
        contImgsSelected.appendChild(spanElement);
        closeAddImage()
    }

    function removeImg(name){
        document.getElementById("img_"+name).remove();
        notShowImg();
    }

    function showImg(name){
        let home = document.getElementById("homeSelector").value;
        document.getElementById("imagePreView").innerHTML = `<img src="imgs/${home}/${name}" width="200px" height="200px">`;
    }
    function notShowImg(){
        document.getElementById("imagePreView").innerHTML = ``;
    }

    function emptyImgSelector(){
        document.getElementById("imgsSelected").innerHTML = "";
    }
</script>